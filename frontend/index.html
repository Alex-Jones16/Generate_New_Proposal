<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Proposal Generator</title>
  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h2>AI Proposal Generator</h2>
    <section id="samples">
      <h3>Sample Proposals</h3>
      <ul id="proposal-list"></ul>
    </section>
    <section id="job-section">
      <h3>Generate Proposals (Top 2 Styles x OpenAI/Claude)</h3>
      <textarea id="job-desc" rows="5" placeholder="Paste job description here..."></textarea>
      <button id="generate-btn">Generate</button>
      <div id="error" style="display:none;" class="error"></div>
    </section>
    <div id="loading" style="display:none;">Generating proposals...</div>
    <section id="results" style="display:none;">
      <h3>Matched Samples</h3>
      <div>
        <b>Sample A:</b>
        <pre id="sample-a"></pre>
      </div>
      <div>
        <b>Sample B:</b>
        <pre id="sample-b"></pre>
      </div>
      <h3>Generated Proposals</h3>
      <div>
        <b>OpenAI (Sample A):</b>
        <pre id="openai-a"></pre>
      </div>
      <div>
        <b>OpenAI (Sample B):</b>
        <pre id="openai-b"></pre>
      </div>
      <div>
        <b>Claude (Sample A):</b>
        <pre id="claude-a"></pre>
      </div>
      <div>
        <b>Claude (Sample B):</b>
        <pre id="claude-b"></pre>
      </div>
    </section>
  </div>
<script>
// Set this to your Render URL, e.g. "https://your-service.onrender.com"
const BACKEND_BASE = ""; // <-- fill in after deploying backend to Render

function api(path) { return `${BACKEND_BASE}${path}`; }

async function fetchProposals() {
  try {
    const res = await fetch(api('/proposals'));
    if(!res.ok) throw new Error('Failed to load proposals: ' + res.status);
    const data = await res.json();
    const ul = document.getElementById('proposal-list');
    ul.innerHTML = '';
    data.forEach(p => {
      const li = document.createElement('li');
      li.textContent = p.name;
      ul.appendChild(li);
    });
  } catch (e) {
    console.error(e);
    document.getElementById('proposal-list').innerHTML = '<li>Could not load proposals.</li>';
  }
}
async function generate() {
  const errorBox = document.getElementById('error');
  errorBox.style.display = 'none';
  errorBox.textContent = '';
  const job = document.getElementById('job-desc').value;
  if(!job.trim()) { errorBox.textContent = 'Please enter a job description.'; errorBox.style.display='block'; return; }
  if(!BACKEND_BASE) { errorBox.textContent = 'Please set BACKEND_BASE to your Render URL in index.html.'; errorBox.style.display='block'; return; }
  document.getElementById('loading').style.display = 'block';
  document.getElementById('results').style.display = 'none';
  try {
    const response = await fetch(api('/generate'), {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({job_description: job})
    });
    const text = await response.text();
    if(!response.ok) {
      throw new Error('Request failed: ' + response.status + ' ' + text);
    }
    let result;
    try { result = JSON.parse(text); } catch(parseErr) {
      throw new Error('Invalid JSON response: ' + text.slice(0, 200));
    }
    const ms = result.matched_samples || [];
    const a = ms[0] || {}; const b = ms[1] || {};
    document.getElementById('sample-a').textContent = (a.name||'') + '\n---\n' + (a.content||'');
    document.getElementById('sample-b').textContent = (b.name||'') + '\n---\n' + (b.content||'');
    const r = result.results || [];
    const findText = (prov, idx) => {
      const item = r.find(x => x.provider===prov && x.sample_index===idx);
      return item ? (item.text||'') : '';
    };
    document.getElementById('openai-a').textContent = findText('openai', 0);
    document.getElementById('openai-b').textContent = findText('openai', 1);
    document.getElementById('claude-a').textContent = findText('claude', 0);
    document.getElementById('claude-b').textContent = findText('claude', 1);

    document.getElementById('results').style.display = 'block';
  } catch (e) {
    console.error(e);
    errorBox.textContent = e.message;
    errorBox.style.display = 'block';
  } finally {
    document.getElementById('loading').style.display = 'none';
  }
}
document.getElementById('generate-btn').onclick = generate;
window.onload = fetchProposals;
</script>
</body>
</html>
